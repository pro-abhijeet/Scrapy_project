This code has many errors. 

UPDATED code will be committed later.